<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkers</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9fafb;
      margin: 0;
      padding: 0;
    }
    canvas {
      border: 4px solid #333;
      border-radius: 8px;
      background-color: #fff;
    }
    .reset-button, .undo-button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .reset-button:hover, .undo-button:hover {
      background-color: #45a049;
    }
    .treasure {
      width: 80px;
      height: 80px;
      background: url('https://cdn-icons-png.flaticon.com/512/3081/3081986.png') no-repeat center/cover;
      position: relative;
    }
    .gem {
      width: 16px;
      height: 16px;
      background: url('https://cdn-icons-png.flaticon.com/512/650/650143.png') no-repeat center/contain;
      position: absolute;
      animation: dropGem 1s ease forwards;
    }
    @keyframes dropGem {
      from { top: -30px; opacity: 0; }
      to { top: 20px; opacity: 1; }
    }
  </style>
</head>
<body class="flex flex-col items-center p-6">

  <!-- Player Name Setup -->
  <div id="nameInput" class="flex flex-col items-center space-y-4">
    <h1 class="text-3xl font-bold">Enter Player Names</h1>
    <input type="text" id="playerRed" placeholder="Red Player Name" class="border p-2 rounded"/>
    <input type="text" id="playerBlack" placeholder="Black Player Name" class="border p-2 rounded"/>
    <button onclick="startGame()" class="reset-button">Start Game</button>
  </div>

  <!-- Main Game -->
  <div id="gameUI" class="hidden flex flex-col items-center space-y-4">
    <div class="flex items-center justify-between w-full max-w-xl">
      <div class="text-xl font-semibold"><span id="redName">Red</span> Coins: <span id="redCoins">0</span></div>
      <div class="text-xl font-semibold"><span id="blackName">Black</span> Coins: <span id="blackCoins">0</span></div>
    </div>

    <div id="messageBox" class="text-xl font-bold text-blue-700"></div>
    <canvas id="checkerboard" width="600" height="600"></canvas>

    <div class="flex space-x-4">
      <button id="resetButton" class="reset-button">Reset</button>
      <button id="undoButton" class="undo-button">Undo</button>
    </div>

    <!-- Treasure Chest -->
    <div id="treasure" class="treasure mt-6 hidden"></div>
  </div>

  <!-- Leaderboard -->
  <div class="mt-10 w-full max-w-xl">
    <h2 class="text-2xl font-bold mb-2">üèÜ Leaderboard</h2>
    <ul id="leaderboard" class="space-y-1 text-lg text-gray-800"></ul>
  </div>

  <!-- Sounds -->
  <audio id="jumpSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_8509567329.mp3?filename=pop-94319.mp3" preload="auto"></audio>
  <audio id="kingSound" src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_9e8fe28517.mp3?filename=notification-89939.mp3" preload="auto"></audio>
  <audio id="winSound" src="https://cdn.pixabay.com/download/audio/2022/10/03/audio_33c1b4bfa0.mp3?filename=success-fanfare-trumpets-6185.mp3" preload="auto"></audio>

  <script>
    let currentPlayer = 'red';
    let board = [];
    let history = [];
    let redCoins = 0;
    let blackCoins = 0;
    let selected = null;
    let playerNames = { red: 'Red', black: 'Black' };

    function startGame() {
      playerNames.red = document.getElementById('playerRed').value || 'Red';
      playerNames.black = document.getElementById('playerBlack').value || 'Black';
      document.getElementById('nameInput').classList.add('hidden');
      document.getElementById('gameUI').classList.remove('hidden');
      document.getElementById('redName').textContent = playerNames.red;
      document.getElementById('blackName').textContent = playerNames.black;
      initializeBoard();
    }

    function initializeBoard() {
      board = Array.from({ length: 8 }, () => Array(8).fill(0));
      for (let r = 0; r < 3; r++) for (let c = 0; c < 8; c++) if ((r + c) % 2) board[r][c] = 1;
      for (let r = 5; r < 8; r++) for (let c = 0; c < 8; c++) if ((r + c) % 2) board[r][c] = 2;
      history = [];
      redCoins = 0; blackCoins = 0;
      updateCoins();
      selected = null;
      drawBoard();
      updateMessage(`${playerNames.red}'s Turn`);
    }

    function drawBoard() {
      const canvas = document.getElementById('checkerboard');
      const ctx = canvas.getContext('2d');
      const size = canvas.width / 8;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
          ctx.fillStyle = (r + c) % 2 === 0 ? '#f0d9b5' : '#b58863';
          ctx.fillRect(c * size, r * size, size, size);
          if (selected && selected.row === r && selected.col === c) {
            ctx.fillStyle = '#ffeb3b';
            ctx.fillRect(c * size, r * size, size, size);
          }
          const piece = board[r][c];
          if (piece) {
            ctx.beginPath();
            ctx.arc(c * size + size/2, r * size + size/2, size * 0.35, 0, Math.PI * 2);
            ctx.fillStyle = (piece === 1 || piece === 3) ? '#cc0000' : '#333';
            ctx.fill(); ctx.stroke();
            if (piece === 3 || piece === 4) {
              ctx.fillStyle = 'gold';
              ctx.font = `${size * 0.5}px Arial`;
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              ctx.fillText('‚ôî', c * size + size/2, r * size + size/2);
            }
          }
        }
      }
    }

    function updateCoins() {
      document.getElementById('redCoins').textContent = redCoins;
      document.getElementById('blackCoins').textContent = blackCoins;
    }

    function updateMessage(msg) {
      document.getElementById('messageBox').textContent = msg;
    }

    document.getElementById('resetButton').onclick = initializeBoard;
    document.getElementById('undoButton').onclick = () => {
      if (history.length) {
        const last = history.pop();
        board = JSON.parse(JSON.stringify(last));
        currentPlayer = currentPlayer === 'red' ? 'black' : 'red';
        drawBoard();
        updateMessage(`${playerNames[currentPlayer]}'s Turn`);
      }
    };

    function showWinner(winnerColor) {
      const treasure = document.getElementById('treasure');
      treasure.classList.remove('hidden');
      document.getElementById('winSound').play();
      updateMessage(`${playerNames[winnerColor]} Wins! üéâ`);
      for (let i = 0; i < 10; i++) {
        const gem = document.createElement('div');
        gem.className = 'gem';
        gem.style.left = `${Math.random() * 50 + 15}px`;
        gem.style.animationDelay = `${i * 0.2}s`;
        treasure.appendChild(gem);
      }
      updateLeaderboard(playerNames[winnerColor]);
    }

    function updateLeaderboard(winner) {
      const board = JSON.parse(localStorage.getItem('leaderboard') || '{}');
      board[winner] = (board[winner] || 0) + 1;
      localStorage.setItem('leaderboard', JSON.stringify(board));
      renderLeaderboard();
    }

    function renderLeaderboard() {
      const data = JSON.parse(localStorage.getItem('leaderboard') || '{}');
      const list = document.getElementById('leaderboard');
      list.innerHTML = '';
      Object.entries(data).sort((a, b) => b[1] - a[1]).forEach(([name, score]) => {
        const li = document.createElement('li');
        li.textContent = `${name}: ${score} wins`;
        list.appendChild(li);
      });
    }

    document.getElementById('checkerboard').onclick = e => {
      const canvas = e.target;
      const rect = canvas.getBoundingClientRect();
      const size = canvas.width / 8;
      const x = Math.floor((e.clientX - rect.left) / size);
      const y = Math.floor((e.clientY - rect.top) / size);
      const piece = board[y][x];

      const isRed = currentPlayer === 'red';
      const isOwnPiece = (piece === 1 || piece === 3) && isRed || (piece === 2 || piece === 4) && !isRed;

      if (selected && (x !== selected.col || y !== selected.row)) {
        const valid = isValidMove(selected.row, selected.col, y, x);
        if (valid) {
          history.push(JSON.parse(JSON.stringify(board)));
          board[y][x] = board[selected.row][selected.col];
          board[selected.row][selected.col] = 0;
          if (valid.jump) {
            board[valid.jump.row][valid.jump.col] = 0;
            document.getElementById('jumpSound').play();
          }
          if (currentPlayer === 'red' && y === 7 && board[y][x] === 1) {
            board[y][x] = 3; document.getElementById('kingSound').play();
          }
          if (currentPlayer === 'black' && y === 0 && board[y][x] === 2) {
            board[y][x] = 4; document.getElementById('kingSound').play();
          }
          selected = null;
          currentPlayer = isRed ? 'black' : 'red';
          drawBoard();
          updateMessage(`${playerNames[currentPlayer]}'s Turn`);
          checkWinner();
          return;
        }
      }

      if (isOwnPiece) {
        selected = { row: y, col: x };
        drawBoard();
      }
    };

    function isValidMove(sr, sc, er, ec) {
      const dx = ec - sc;
      const dy = er - sr;
      const absDx = Math.abs(dx);
      const absDy = Math.abs(dy);
      if (absDx !== absDy || absDx > 2 || board[er][ec] !== 0) return null;
      const piece = board[sr][sc];
      const forward = currentPlayer === 'red' ? 1 : -1;
      const isKing = piece === 3 || piece === 4;
      if (!isKing && dy !== forward && absDy === 1) return null;
      if (absDx === 2) {
        const midRow = (sr + er) / 2;
        const midCol = (sc + ec) / 2;
        const jumped = board[midRow][midCol];
        if (currentPlayer === 'red' && (jumped === 2 || jumped === 4)) return { jump: { row: midRow, col: midCol } };
        if (currentPlayer === 'black' && (jumped === 1 || jumped === 3)) return { jump: { row: midRow, col: midCol } };
        return null;
      }
      return { jump: null };
    }

    function checkWinner() {
      let red = 0, black = 0;
      for (let row of board) for (let cell of row) {
        if (cell === 1 || cell === 3) red++;
        if (cell === 2 || cell === 4) black++;
      }
      if (red === 0) showWinner('black');
      if (black === 0) showWinner('red');
    }

    renderLeaderboard();
  </script>
</body>
</html>
